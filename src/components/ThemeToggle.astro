---
import { Icon } from "astro-icon/components";
---

<button
  type="button"
  id="themeToggle"
  title="Toggle theme"
  class="inline-flex cursor-pointer items-center justify-center motion-reduce:duration-0 md:text-neutral-600 contrast-more:md:text-black dark:text-neutral-300 contrast-more:dark:text-white md:hocus:text-neutral-600/75 dark:hocus:text-neutral-300/75"
>
  <span class="sr-only">Toggle theme</span>

  <Icon name="heroicons:moon" class="h-7 w-7 md:h-6 md:w-6 dark:hidden" />
  <Icon name="heroicons:sun" class="hidden h-7 w-7 md:h-6 md:w-6 dark:inline" />
</button>

<button
  type="button"
  id="fontToggle"
  title="Toggle font"
  class="inline-flex cursor-pointer items-center justify-center motion-reduce:duration-0 md:text-neutral-600 contrast-more:md:text-black dark:text-neutral-300 contrast-more:dark:text-white md:hocus:text-neutral-600/75 dark:hocus:text-neutral-300/75"
>
  <span class="sr-only">Toggle font</span>

  <Icon name="heroicons:bold" class="h-7 w-7 md:h-6 md:w-6" />
</button>

<script is:inline>
  // Ensure that window._paq is defined before using it
  window._paq = window._paq || [];

  function getTheme() {
    const localStorageTheme = localStorage.getItem("theme");
    if (
      typeof localStorageTheme !== "undefined" &&
      localStorageTheme !== null
    ) {
      return localStorageTheme;
    }

    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      return "dark";
    }
    return "light";
  }

  function getFont() {
    const localStorageFont = localStorage.getItem("font");
    if (typeof localStorageFont !== "undefined" && localStorageFont !== null) {
      return localStorageFont;
    }
    return "sans";
  }

  function setTheme(document, toggle = false) {
    let theme = getTheme();
    if (toggle) {
      theme = theme === "light" ? "dark" : "light";
    }

    document.documentElement.dataset.theme = theme;
    window.localStorage.setItem("theme", theme);
    window._paq?.push(["setCustomDimension", 1, theme]);
  }

  function setFont(document, toggle = false) {
    let font = getFont();
    if (toggle) {
      font = font === "sans" ? "serif" : "sans";
    }

    document.documentElement.dataset.font = font;
    window.localStorage.setItem("font", font);
    window._paq?.push(["setCustomDimension", 2, font]);
  }

  setTheme(document);
  setFont(document);

  document.addEventListener("astro:before-swap", (event) => {
    setTheme(event.newDocument);
    setFont(event.newDocument);
  });

  document.getElementById("themeToggle")?.addEventListener("click", () => {
    setTheme(document, true);
    window._paq?.push(["trackEvent", "Theme", "Toggle", getTheme()]);
  });
  document.getElementById("fontToggle")?.addEventListener("click", () => {
    setFont(document, true);
    window._paq?.push(["trackEvent", "Font", "Toggle", getFont()]);
  });
</script>
